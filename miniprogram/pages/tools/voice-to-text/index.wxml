<view class="container">
  <!-- 工具导航栏 -->
  <view class="tool-navbar">
    <view class="nav-back" bindtap="navigateBack">
      <view class="back-icon"></view>
    </view>
    <view class="nav-title">语音转文字</view>
  </view>

  <!-- 录音区域 -->
  <view class="record-section {{isRecording ? 'recording' : ''}}">
    <view class="record-circle {{isRecording ? 'active' : ''}}" bindtap="{{isRecording ? 'stopRecording' : 'startRecording'}}">
      <view class="record-icon"></view>
    </view>
    <view class="record-time">{{recordTimeStr}}</view>
    <view class="record-hint">{{isRecording ? '点击停止录音' : '点击开始录音'}}</view>
  </view>

  <!-- 转写中提示 -->
  <view class="processing-section" wx:if="{{isTranscribing}}">
    <view class="loading"></view>
    <view class="process-text">转写中...</view>
  </view>

  <!-- 错误提示 -->
  <view class="error-message" wx:if="{{errorMessage}}">
    {{errorMessage}}
  </view>

  <!-- 转写结果区域 -->
  <view class="result-section" wx:if="{{showResult}}">
    <view class="result-header">
      <view class="play-button" bindtap="playRecording">
        <view class="play-icon"></view>
      </view>
      <view class="duration">录音时长：{{recordTimeStr}}</view>
    </view>

    <view class="transcript-box">
      <text class="transcript-text">{{transcriptText}}</text>
    </view>

    <view class="action-buttons">
      <button class="action-btn copy-btn" bindtap="copyText">复制文本</button>
      <button class="action-btn reset-btn" bindtap="resetRecording">重新录音</button>
    </view>
  </view>

  <!-- 历史记录区域 -->
  <view class="history-section" wx:if="{{!isRecording && !isTranscribing && !showResult}}">
    <view class="history-title">录音历史</view>
    <view class="history-list" wx:if="{{history.length > 0}}">
      <view class="history-item" wx:for="{{history}}" wx:key="id" bindtap="viewHistoryItem" data-id="{{item.id}}">
        <view class="history-item-left">
          <view class="history-play-icon"></view>
          <view class="history-info">
            <view class="history-transcript-preview">{{item.transcript}}</view>
            <view class="history-date">{{item.date}}</view>
          </view>
        </view>
        <!-- <view class="history-duration">{{Math.floor(item.duration / 60).toString().padStart(2, '0')}}:{{(item.duration % 60).toString().padStart(2, '0')}}</view> -->
      </view>
    </view>
    <view class="empty-history" wx:else>
      <view class="empty-icon"></view>
      <view class="empty-text">暂无录音历史</view>
    </view>
  </view>

  <!-- 使用提示 -->
  <view class="tips-section" wx:if="{{!isRecording && !isTranscribing && !showResult && history.length === 0}}">
    <view class="tip-item">
      <view class="tip-icon">1</view>
      <view class="tip-text">点击中央按钮开始录音</view>
    </view>
    <view class="tip-item">
      <view class="tip-icon">2</view>
      <view class="tip-text">录音完成后将自动进行转写</view>
    </view>
    <view class="tip-item">
      <view class="tip-icon">3</view>
      <view class="tip-text">您可以复制转写文本或播放录音</view>
    </view>
  </view>
</view>